# KalmanFilter
Which is the module of apollo used the ExtendedKalmanFilter?

卡尔曼滤波是一种高效率的递归滤波器(自回归滤波器), 它能够从一系列的不完全包含噪声的测量(英文:measurement)中，估计动态系统的状态，然而简单的卡尔曼滤波必须应用在符合高斯分布的系统中。

百度百科是这样说的，也就是说卡尔曼滤波第一是递归滤波，其次KF用于线性系统。

但经过研究和改进，出现了很多卡尔曼，如EKF（extended kalman filter）扩展卡尔曼，UKF（Unscented Kalman Filter）无迹卡尔曼等等。

而我们就来研究EKF，而EKF的中心思想就是将非线性系统线形化后再做KF处理。

为什么要用EKF

KF的假设之一就是高斯分布的x
预测后仍服从高斯分布，高斯分布的x变换到测量空间后仍服从高斯分布。可是，假如F、H

是非线性变换，那么上述条件则不成立。
将非线性系统线性化

既然非线性系统不行，那么很自然的解决思路就是将非线性系统线性化。

对于一维系统，采用泰勒一阶展开即可得到：

f(x)≈f(μ)+∂f(μ)∂x(x−μ)

对于多维系统，仍旧采用泰勒一阶展开即可得到：

T(x)≈f(a)+(x−a)TDf(a)

其中，Df(a)
是Jacobian矩阵。

多传感器融合
lidar与radar

本文将以汽车跟踪为例，目标是知道汽车时刻的状态x=(px,py,vx,vy)

。已知的传感器有lidar、radar。

    lidar：笛卡尔坐标系。可检测到位置，没有速度信息。其测量值z=(px,py)

。
radar：极坐标系。可检测到距离，角度，速度信息，但是精度较低。其测量值z=(ρ,ϕ,ρ˙)
，图示如下。



问:障碍检测中数据融合的卡尔曼滤波的算法变形的依据是什么？数据融合上，我有两个问题：
1.perception模块 障碍检测中的融合部分用到了卡尔曼滤波，但这里对卡尔曼滤波的公式作了变形。在更新噪声协方差时标准卡尔曼：

P=（I-K * H） * P_
Apollo：
P=(I-K * H) * P_ * (I- K * H).transpose + K * R * K.transpose
其余四个公式未做任何变化，请问能给出变形的依据或者论文么？2.该融合用得是标准卡尔曼。对 Lidar 和 Radar 的数据处理貌似使用了相同的观察矩阵 H。那 Radar 模块中应该对数据进行了从非线性到线性的变换。 这样提前处理优势显而易见，方便了滤波器的程序的编写。

我的问题是，这样对滤波器的最终效果会带来怎样的影响呢？

答:

1.可以参考卡尔曼滤波的维基百科： https://en.wikipedia.org/wiki/Kalman_filter. 如果K是最佳卡尔曼增益，则可以简化。

2.我们使用的大陆毫米波雷达提供原始位置（x，y）和相对速度信息（x，y），你可以在毫米波雷达模块中找到一些细节，或者查看modules/drivers/conti_radar目录文件。

为了扩展性，我们从传感器检测器获得相同的状态，并使用相同的H。事实上，标准卡尔曼滤波器在我们的系统中并不是一个耗时的子模块。如果你可以很好地理解传感器的状态，你可以尝试使用简化的状态。


Apollo中使用卡曼滤波的有perception/obstacle/camera/filter和perception/obstacle/lidar/tracker/hm_tracker
